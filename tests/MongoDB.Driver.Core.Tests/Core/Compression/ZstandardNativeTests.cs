/* Copyright 2019-present MongoDB Inc.
*
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
*/

using System;
using System.IO;
using System.IO.Compression;
using System.Linq;
using System.Text;
using FluentAssertions;
using MongoDB.Driver.Core.Compression.Zstd;
using Xunit;

namespace MongoDB.Driver.Core.Tests.Core.Compression
{
    public class StandardTests
    {
        private const string TestMessage = @"Lorem ipsum dolor sit amet, consectetur adipiscing elit. Nullam rhoncus felis mauris, nec sodales est porta vitae. Maecenas pellentesque lectus et leo viverra, sit amet consequat ante porta. Cras vel rutrum nulla. In et justo mollis, lobortis tortor id, efficitur ex. Maecenas sit amet odio bibendum, lacinia elit sit amet, imperdiet erat. Etiam pharetra nisi et sem mollis commodo. Vestibulum sagittis euismod bibendum. Praesent posuere metus et leo pulvinar, nec accumsan ipsum luctus. Suspendisse ultricies odio ac volutpat pharetra.
In at tempor dui.Aliquam aliquet tincidunt leo sit amet eleifend. Nulla facilisi. Ut leo diam, consectetur semper orci nec, imperdiet ultrices turpis.Fusce enim massa, hendrerit semper ultricies non, scelerisque vitae sem.Nulla malesuada tortor vel dolor laoreet, eu pretium erat condimentum. Praesent quis neque sed ex mollis malesuada.Vivamus placerat massa eu ultrices placerat. Curabitur tempus risus ac quam consectetur, non dapibus justo lacinia. Nullam a molestie neque. Nullam nec tellus nisi. Morbi gravida turpis non lorem hendrerit aliquet.Fusce ornare mi non tempor pretium.
Nulla lobortis at augue sed iaculis. Nulla feugiat vel enim bibendum porttitor. Aliquam id ex nunc. Interdum et malesuada fames ac ante ipsum primis in faucibus.Etiam et ornare elit, at cursus nunc.Donec luctus enim metus, vel faucibus turpis auctor ac.Nulla facilisi. Donec diam elit, congue convallis quam et, iaculis cursus nisl.Donec at neque neque. Proin laoreet placerat sollicitudin. Vestibulum pharetra est sed imperdiet consequat. Nam sit amet fermentum odio.Morbi ac sollicitudin ante. Cras scelerisque ornare maximus. Vivamus finibus eu nibh at dapibus. Maecenas elit diam, porta id aliquam commodo, tincidunt et ex.
Vestibulum scelerisque efficitur hendrerit. Vivamus faucibus et nunc quis iaculis. Curabitur nec sapien mollis, volutpat tellus eu, porttitor odio. Praesent molestie urna laoreet tortor ultricies rhoncus.Nulla finibus viverra condimentum. Maecenas imperdiet aliquam lacus, in blandit metus interdum at. Donec nec leo iaculis, ultrices risus a, laoreet purus. Nam diam ante, vehicula a lacinia rutrum, euismod id tellus.Nunc dignissim orci neque, eget congue sem accumsan sed.Integer lacinia commodo pretium.
Nullam in ex nec diam egestas dictum.Quisque cursus lacus vitae dignissim semper. Quisque ut justo tristique ex venenatis vehicula.In pretium facilisis risus ut tincidunt. Mauris eu eros a nisl suscipit hendrerit.Etiam quam metus, auctor vel pulvinar eu, consequat non orci.Quisque vehicula scelerisque ex sed dapibus. Fusce maximus nulla dui, porttitor interdum ante tristique at.Vestibulum faucibus finibus velit at vestibulum. Sed venenatis pulvinar nibh pellentesque tincidunt. Ut lobortis mi est, a pellentesque ex tristique in. Praesent dolor neque, lacinia non dignissim nec, luctus eget lorem.
Fusce quis efficitur ante. Aliquam erat volutpat.Nunc sem tellus, tempus in metus eget, pretium interdum massa.Nullam luctus dui ac sapien fermentum vulputate.Cras gravida diam eget urna volutpat, ut condimentum enim condimentum. Vestibulum neque odio, cursus ac sollicitudin nec, elementum vehicula justo.Praesent at fermentum nibh, a fringilla elit.
Ut dapibus semper tortor at accumsan. Maecenas maximus bibendum felis vel laoreet. Aliquam condimentum convallis ante, quis luctus ex.Vivamus eget fermentum tortor, eu pretium sem.Aliquam mollis imperdiet maximus. Praesent ipsum odio, blandit eget rutrum sed, rhoncus vitae elit.Maecenas lobortis orci risus, ac egestas ante fringilla a.Duis quis est velit. Suspendisse eu varius sem. Phasellus dolor tellus, pharetra ac nisi non, sollicitudin aliquam tellus.Maecenas facilisis efficitur metus, vitae tincidunt leo lobortis tincidunt.
Nulla lacinia vehicula massa, vel molestie mauris.Curabitur non dolor eget lorem hendrerit vehicula vel porta lorem. Aenean purus urna, eleifend sed tortor at, suscipit interdum eros.Nunc quis pulvinar est. Curabitur maximus turpis ac tortor tincidunt, sit amet fringilla velit laoreet.Proin ullamcorper ante magna, sit amet tristique justo tempor a. Mauris quam lacus, consectetur eu faucibus tempus, rhoncus ut lacus.Curabitur viverra felis est, et laoreet risus porta vel.
Nullam laoreet non dui quis fermentum. Vestibulum et leo id purus commodo mollis.Praesent ac hendrerit turpis. Sed eu posuere arcu. Nulla eget justo porttitor, hendrerit elit quis, vulputate felis. Aenean at lorem sed ipsum luctus rutrum id sed quam. Donec et fringilla quam. Vestibulum in luctus elit, in tincidunt ex. Ut faucibus sit amet dui quis rutrum.Suspendisse eu augue faucibus, vulputate tellus at, hendrerit arcu. Vestibulum accumsan nisl sit amet lobortis varius.
Quisque mollis diam sollicitudin, dapibus tortor sed, bibendum ex. Maecenas ac dui commodo, ornare lectus non, euismod lorem. Sed tempor ligula sit amet varius vehicula.Integer aliquet dui ac tortor bibendum, eget semper lacus ullamcorper. Nullam sodales congue nulla, eu volutpat felis tincidunt sit amet. Etiam congue augue dolor, consequat dapibus justo facilisis at.Donec non arcu eget eros volutpat feugiat.Sed nulla magna, varius sit amet iaculis ac, porttitor quis nunc.
Fusce nec dolor lectus. Aliquam aliquet vehicula ligula a venenatis. Quisque a tortor sed orci dapibus imperdiet vitae at velit. Fusce varius enim non lacus fringilla, sed dapibus ligula efficitur. Aliquam hendrerit tempus nisl quis molestie. Fusce at laoreet ligula. Aliquam in sem non turpis suscipit vestibulum non a urna.
Sed tempor condimentum turpis. Nam elementum eros vulputate ex hendrerit tincidunt.Sed vitae velit vitae dui tincidunt euismod.Vestibulum lacinia ac orci vitae gravida. Cras laoreet purus id leo porttitor commodo.Morbi quis diam nisi. Aliquam scelerisque augue odio, vitae gravida ex vestibulum et.Curabitur tempus lacus sed viverra pulvinar. In gravida fermentum nisi et lobortis. Nulla congue varius blandit. In non nisi a dolor dictum rhoncus.Phasellus nunc quam, accumsan non auctor vitae, pharetra et lacus.Phasellus sodales laoreet vulputate.
Sed a eleifend libero, a suscipit enim.In pulvinar nisl ac leo ultricies efficitur.Cras elementum nibh odio, sed sodales nisi facilisis ac.Vivamus ut sem ac nulla elementum mollis vel non ante. Morbi vehicula et massa ut volutpat. Donec quis metus in nulla posuere consequat.Morbi tempus quam ut dui commodo gravida.Suspendisse id nulla et nibh congue gravida vel sit amet magna.Proin hendrerit consequat metus, in scelerisque nisi iaculis a. Vestibulum cursus est id risus convallis pellentesque.Morbi nec ante ullamcorper, fringilla eros et, finibus sapien. Donec imperdiet in nibh id feugiat.Donec imperdiet, mi a lacinia tincidunt, libero urna mollis tortor, ac semper odio turpis eu lorem. Proin sed vehicula metus.
Vivamus auctor, ipsum eget elementum elementum, odio diam dictum eros, a laoreet nunc purus ullamcorper arcu. Pellentesque sem tortor, aliquet in orci a, viverra mattis tellus.Quisque at faucibus tortor. Proin ultrices, mauris quis mattis lobortis, ipsum lectus porttitor libero, vitae mattis ante lacus et risus. Nunc in est suscipit, finibus erat et, pretium lacus. Morbi volutpat, lorem sit amet fermentum venenatis, enim est venenatis dui, ac laoreet tellus enim sit amet ligula.In sapien massa, sodales non justo pretium, mollis sagittis risus.Praesent sit amet mauris enim.Nullam id leo ipsum. Donec orci massa, semper nec massa vitae, volutpat venenatis nibh.Aenean scelerisque ipsum turpis, ut convallis nisl mattis non.
Cras ex dui, tempor et nulla nec, commodo interdum eros.Phasellus dignissim semper augue, at elementum quam mattis at.Nunc ut tincidunt dolor. Interdum et malesuada fames ac ante ipsum primis in faucibus.Sed ut mauris volutpat, rhoncus leo non, tincidunt metus. Vestibulum egestas, dolor non scelerisque vestibulum, orci tortor fringilla magna, sed mattis purus turpis et dolor. Sed ultrices nisi sapien. Ut interdum vulputate velit ac volutpat. Curabitur venenatis convallis nisl, ut semper neque sollicitudin in. Maecenas nec massa elementum, tempor arcu id, egestas purus. Nulla sit amet eleifend felis, pellentesque posuere orci.Fusce sit amet arcu malesuada, euismod justo quis, vestibulum ligula. Aenean faucibus tortor non varius lobortis. Vivamus in rhoncus odio. Curabitur pulvinar erat sed blandit semper.
Pellentesque imperdiet est ante, ac iaculis risus consectetur eget.Praesent ultrices massa id imperdiet auctor. Aliquam nec laoreet mauris. Donec commodo tellus suscipit est fermentum, non porta nisi aliquam. Mauris fermentum ante eu lectus molestie pulvinar.Duis eu urna luctus sapien maximus vehicula quis in elit.Donec ultrices tellus in condimentum semper. Vestibulum ante ipsum primis in faucibus orci luctus et ultrices posuere cubilia Curae; Sed euismod sapien et ipsum auctor aliquam.Fusce id enim sapien.
Integer in erat hendrerit, porttitor tellus eget, accumsan ante. Quisque interdum condimentum urna et porta. Praesent et elit vitae erat ultrices suscipit non in libero.Donec enim enim, sollicitudin ac eros et, lobortis ultricies est.Maecenas nec ex id nunc interdum sodales.Fusce lacinia nibh vel finibus viverra. Sed condimentum feugiat nulla, vitae tincidunt velit elementum et.Nullam mollis maximus accumsan. Nunc pharetra hendrerit risus eget pulvinar. Integer dignissim pharetra nunc nec vestibulum. Praesent efficitur leo eget bibendum suscipit. Pellentesque sagittis finibus sapien, nec condimentum ante vestibulum id.Etiam malesuada eros mauris, eu cursus ex malesuada eu.Aenean blandit eros eu pharetra ornare. Nam ullamcorper gravida elit porta rhoncus. Vivamus eget accumsan quam, fermentum convallis turpis.
Suspendisse accumsan placerat convallis. In faucibus eu est vel sagittis. Aliquam blandit accumsan nibh. Aliquam erat volutpat.Mauris eu pharetra ante, viverra accumsan eros.Aliquam aliquam dui at dignissim elementum. Ut imperdiet, nisl sit amet mollis tincidunt, arcu nunc bibendum augue, et finibus nunc augue vel dui. Quisque vel arcu non magna pharetra mattis.Cras nec quam at diam sagittis dictum.Nunc et dapibus nisl, id tincidunt diam.Nullam in sapien nec eros elementum posuere.Aenean tortor purus, laoreet sit amet lacus a, euismod lacinia dolor.
Pellentesque sollicitudin luctus elementum. Aenean sed turpis vel erat commodo luctus quis eu justo. Curabitur sit amet rutrum ligula, laoreet maximus augue.Cras tincidunt ipsum vitae tortor placerat ultricies.Donec quis diam lobortis, fermentum magna sed, sollicitudin erat. Mauris nec viverra mauris. Nulla facilisi. Sed gravida orci nec nibh convallis, quis sollicitudin libero aliquet. Nam scelerisque nibh et felis mollis, sed suscipit neque pulvinar. Suspendisse fermentum sagittis mi, congue ullamcorper felis eleifend in. Etiam nec magna vitae dolor varius molestie quis eleifend erat. Suspendisse vehicula erat sit amet lectus rutrum ultrices.
Morbi suscipit lorem elit, non fermentum turpis volutpat nec.Integer quam arcu, rhoncus ac convallis quis, aliquet id libero.Nulla quis interdum tellus. Ut quis ante vestibulum, elementum odio non, rutrum augue. Morbi et nisl eu diam sagittis euismod in eu risus. Vivamus in tristique mi. Aliquam a nisl turpis. Pellentesque viverra libero ut porta consequat. Aliquam fringilla lacus neque, nec sollicitudin turpis finibus non.Integer fringilla metus nulla, vel posuere enim iaculis et.Donec lobortis, quam at rutrum dignissim, metus mi mollis libero, a tempus ante lacus sit amet sapien.Nulla ac quam quis neque luctus interdum ac in risus.Class aptent taciti sociosqu ad litora torquent per conubia nostra, per inceptos himenaeos.
Mauris quis est est. Cras dignissim est mi, ac interdum mi blandit ut.Ut pharetra mauris et suscipit ultrices. Etiam bibendum aliquet sem, ac maximus odio pharetra vitae.Mauris finibus, sapien id imperdiet sagittis, elit felis aliquet ante, sed tristique erat dolor non nibh. Cras ornare enim quis ultrices ultricies. Duis quis nisl eros. Vestibulum lorem sapien, dignissim tincidunt magna sed, faucibus congue nunc.Nam sit amet commodo nibh.Nam molestie eros id est scelerisque, quis lacinia enim sagittis. Nullam finibus pretium magna non sollicitudin. Sed et ante et mi feugiat consectetur quis ac risus. Vivamus aliquet, justo id ornare molestie, quam elit placerat velit, in mattis turpis tellus id purus.Curabitur egestas egestas est at ultrices. Cras ultrices in orci at egestas.Integer pellentesque gravida velit finibus congue.
Donec posuere massa ut fermentum faucibus. Donec faucibus venenatis nisl. In felis diam, ullamcorper in euismod nec, finibus vel metus.Nunc magna sapien, accumsan eu elit ut, consectetur tempor lorem.Suspendisse vitae malesuada urna. Integer dolor metus, condimentum ac ante at, eleifend lacinia urna.Vestibulum ante ipsum primis in faucibus orci luctus et ultrices posuere cubilia Curae; Nulla non hendrerit quam, eget hendrerit lectus.Proin condimentum suscipit massa, in ullamcorper dui. Fusce quis urna rhoncus, viverra odio vitae, pretium lectus.
Maecenas auctor sapien et risus dignissim, non malesuada enim vulputate. In imperdiet lectus id quam faucibus viverra.Nunc egestas hendrerit odio, sed hendrerit odio fermentum in. Vestibulum sit amet nunc placerat, vestibulum purus sed, aliquet diam. Aliquam in blandit quam. Duis rutrum dolor in lacus congue, et tincidunt ligula laoreet. Donec euismod, elit vitae egestas aliquam, felis nibh lobortis metus, eget faucibus metus orci ac arcu. Sed varius sapien sed sem aliquam, vitae tristique lectus malesuada. Nunc laoreet dapibus sapien, in laoreet tortor convallis cursus. Nunc eget neque ut turpis venenatis aliquam.Sed imperdiet tortor arcu, sit amet convallis turpis malesuada vitae.
Aliquam erat volutpat.In ante nisl, porta id dui eu, scelerisque placerat neque.Etiam ultricies suscipit tincidunt. Nunc luctus purus orci, et ultricies nunc sagittis a.Sed tincidunt porttitor ante sit amet sodales.Morbi feugiat tempus dolor non consequat. Proin eu metus ac metus elementum scelerisque.In leo velit, mollis in ligula quis, fringilla laoreet massa.Mauris facilisis odio vel sodales feugiat. Nulla luctus malesuada odio, sit amet ornare lectus laoreet in. Maecenas feugiat quam in orci dictum, sit amet feugiat erat cursus.Nam semper sodales ligula eu tempus. Donec cursus lobortis ultricies. Nam vitae consequat nibh. Quisque ullamcorper mi non dolor fermentum, scelerisque rhoncus mi cursus. Pellentesque ac accumsan odio, id laoreet nisi.
Suspendisse odio nisl, tristique pulvinar diam vel, malesuada dictum risus.Etiam eu facilisis dui. Sed non ipsum vitae velit tincidunt interdum.Nulla tempor leo sollicitudin turpis pellentesque, ut viverra tortor iaculis. Integer dignissim, eros id feugiat pulvinar, dui magna fringilla odio, ac elementum nibh sapien in enim.Duis malesuada purus vel blandit ornare. Fusce condimentum urna non neque sodales, nec malesuada lectus sagittis. Suspendisse rhoncus velit dignissim diam blandit, quis placerat tellus aliquet. Sed sit amet libero lacus.
Integer nec scelerisque mi. Praesent ut ligula ut neque aliquet finibus at eget neque. Nunc gravida quam ac urna fermentum condimentum.Proin mauris massa, rhoncus et justo sit amet, ornare euismod massa.Praesent non tempus metus. Proin vel blandit ligula, ut efficitur elit.Duis viverra purus in libero eleifend, scelerisque laoreet leo varius. Vivamus condimentum neque eget nunc feugiat cursus.
Vivamus viverra velit tincidunt finibus viverra. Nunc interdum elementum tortor id faucibus. Aliquam vel semper dui. Vestibulum lacinia maximus turpis in feugiat.Suspendisse eleifend pulvinar quam, id tristique ante scelerisque aliquam.Integer sodales velit vitae feugiat auctor. Aenean laoreet arcu eros, eget tristique dui tempus vitae.Quisque purus ligula, mattis quis velit non, iaculis tristique neque.Duis aliquam justo et tempus tristique. Vestibulum imperdiet feugiat magna. Nam pellentesque orci vitae arcu pretium, vel ornare velit porta. Sed purus dui, pharetra non accumsan eget, ultricies et erat.Aliquam et justo rhoncus, malesuada diam quis, maximus nisi. Etiam eget purus pretium, maximus felis sit amet, convallis nisi. Nunc tristique non odio vel porttitor. Integer nisi nulla, facilisis id massa sit amet, ullamcorper venenatis justo.
Morbi non orci dictum, tincidunt ligula vel, hendrerit quam. Vivamus dui elit, scelerisque at urna at, dignissim aliquam est.Phasellus in diam semper, aliquam ligula non, semper tellus. Phasellus eu egestas metus, et luctus est.Aenean ante nisi, tempus sed interdum at, euismod eu est.Nam auctor commodo odio, nec bibendum neque dictum sed.Nunc at facilisis felis, ac fringilla justo.Cras in enim finibus, posuere nisl mollis, posuere leo. Nulla ut felis eu lorem fermentum maximus at in justo.Pellentesque a elementum felis, sed dignissim orci.Duis a tortor vitae sem mollis semper.Duis scelerisque, ante a faucibus iaculis, lectus dolor ornare sapien, in tincidunt metus lectus ac mauris.
Sed non gravida orci, id vehicula mauris.Nulla iaculis, justo sodales dapibus bibendum, neque purus commodo enim, finibus sollicitudin justo ex id erat. Vivamus lobortis vitae est ut hendrerit. Aliquam ut nibh nunc. Nunc rhoncus faucibus elementum. Pellentesque sollicitudin condimentum mauris, ut vestibulum nisi faucibus id.Phasellus suscipit sem eu nibh tempus tincidunt.Vestibulum ante ipsum primis in faucibus orci luctus et ultrices posuere cubilia Curae; Aliquam eget posuere tellus, a elementum mauris.In est nibh, vehicula consequat odio at, consectetur pretium massa.Donec vitae elit ipsum. Nunc sit amet est vel magna maximus finibus.
Duis mollis aliquet eleifend. Quisque eget egestas ante. Vestibulum ante ipsum primis in faucibus orci luctus et ultrices posuere cubilia Curae; Pellentesque porttitor elit justo, eu convallis dui tempus at.Morbi quam nibh, faucibus nec sapien nec, consectetur eleifend nulla.Mauris sagittis vehicula ligula, sed consectetur dui mattis id.Pellentesque faucibus sapien in augue posuere, a pulvinar tellus venenatis. Pellentesque euismod elit vehicula porttitor bibendum. Etiam at risus est. Suspendisse potenti.
Maecenas dapibus sed libero nec porta. Etiam eleifend ex id leo venenatis venenatis.Nulla placerat, dui eget feugiat sagittis, elit nibh sollicitudin erat, id fermentum metus elit id erat. Maecenas orci risus, suscipit et diam ut, ullamcorper malesuada ligula.Donec sodales at magna quis lobortis. Sed scelerisque lacus sit amet dapibus sollicitudin.Vestibulum sit amet dolor in quam posuere molestie ut eget est. Vestibulum ante ipsum primis in faucibus orci luctus et ultrices posuere cubilia Curae; Mauris nec tortor mauris.Quisque congue orci sit amet orci sollicitudin, et porta lorem pulvinar.
Proin tempus ultrices lacus, ullamcorper pulvinar massa hendrerit sed.Duis commodo vulputate diam. Ut eu purus porta nisl cursus suscipit.Curabitur sollicitudin eros volutpat, ultricies nulla eget, volutpat magna. Quisque eget diam et ipsum ullamcorper congue quis id massa. Proin enim augue, semper quis molestie eget, venenatis ac diam.Pellentesque tincidunt leo nisi, rutrum eleifend nisl posuere pretium.Nullam pellentesque at nibh ut molestie. Phasellus turpis lorem, imperdiet id posuere ut, porta non urna.
Maecenas iaculis pulvinar ultricies. Etiam enim velit, placerat id lacus eu, dapibus pulvinar ante.Proin fermentum ex gravida congue egestas. Maecenas dictum mi a posuere fermentum. Suspendisse sodales justo ut neque pharetra facilisis in in turpis.Vestibulum lobortis laoreet gravida. Nulla imperdiet magna lacus, sollicitudin euismod sapien tempor eget.Aliquam erat volutpat.In molestie metus non erat luctus, ac sollicitudin nunc consequat. Pellentesque bibendum velit quis enim fringilla, non pellentesque arcu lobortis. Aenean mollis odio sit amet risus faucibus suscipit.
Nam eget diam tristique, suscipit nisi vel, ultricies erat. Phasellus eu luctus augue. Nunc egestas imperdiet mollis. Nam vehicula, lacus et viverra aliquam, nibh dolor tincidunt lacus, eu mattis tellus erat eu tellus. Curabitur sit amet diam gravida, suscipit sapien dictum, laoreet nisl. Aenean magna enim, suscipit non pulvinar eu, fermentum eget ligula.Cras viverra congue efficitur. Etiam neque ligula, pretium vitae scelerisque id, bibendum at neque.Proin neque purus, tincidunt varius diam a, tristique volutpat erat.Aliquam molestie lacus a magna faucibus ultricies ac nec arcu. Curabitur quis maximus odio. Maecenas ante sem, rutrum in fringilla id, consequat id nisl.
Nunc posuere ante sed metus hendrerit, ut pellentesque nunc fringilla. Mauris sagittis arcu lacus, in viverra mauris ultricies vitae. Nullam auctor nibh a quam luctus, in feugiat erat placerat.Sed sollicitudin consequat mauris ut sollicitudin. Mauris facilisis purus nec sapien congue volutpat.Quisque vel nisl sit amet dolor eleifend semper sed sollicitudin lacus.Proin nec massa posuere, pretium libero in, dictum risus. Sed auctor ultrices erat, ut laoreet purus ornare a.Phasellus efficitur laoreet mauris, viverra commodo odio euismod ac.Aliquam a ipsum eu ligula facilisis elementum ac non lorem. Integer nec efficitur ligula. Quisque posuere sit amet arcu vel faucibus.Quisque nec risus molestie, viverra augue eget, posuere urna. Aliquam pharetra vitae dolor et dictum. Morbi pretium, risus in faucibus viverra, eros nunc posuere augue, eu pellentesque purus arcu ac neque.
Sed faucibus eu sem sit amet eleifend.Vestibulum at enim ornare, dapibus risus non, faucibus leo. Aliquam erat volutpat.Quisque ipsum mauris, blandit sed bibendum eu, fringilla eget quam.Phasellus a mollis justo, in elementum dui. Cras dictum, diam quis porttitor eleifend, ligula elit pellentesque sapien, at laoreet neque leo sit amet enim.Nullam sit amet quam sit amet orci aliquam porta.Nullam gravida consectetur sodales. Morbi non purus libero. Phasellus eros urna, fermentum sit amet dui et, malesuada faucibus magna.Suspendisse potenti.
Maecenas nec arcu vitae nulla vehicula ornare non non purus. Etiam cursus varius ultricies. Vivamus risus tellus, euismod eu magna et, malesuada vehicula ex.Nullam nec leo eu eros auctor fermentum et ac est. Nulla quis sollicitudin neque, eget faucibus velit.Aenean sed turpis tincidunt, luctus nisi eu, tempor urna. Praesent pulvinar nisi bibendum tortor commodo laoreet.Donec venenatis porttitor libero id ullamcorper. Etiam ut lacus purus. Integer iaculis sapien neque, at dignissim magna finibus sit amet.
Donec eleifend mauris non diam luctus, venenatis eleifend ante mollis. Integer imperdiet, lorem a volutpat eleifend, erat orci posuere neque, non tristique arcu libero vitae arcu. Vivamus mi sem, pharetra ac faucibus quis, consectetur rhoncus leo.Sed felis mi, porta interdum tempus egestas, aliquam in arcu.Mauris non porttitor enim. Aenean mauris est, lacinia sit amet turpis nec, mattis euismod sapien.Donec est metus, iaculis ut fermentum et, mollis sed purus.Phasellus in egestas ipsum, quis porta felis.
Aliquam ut eros ornare, convallis quam sit amet, facilisis urna. Nunc vitae vestibulum neque, sit amet ullamcorper lacus. Duis eu lobortis orci. Vestibulum ullamcorper pellentesque purus at lacinia. Class aptent taciti sociosqu ad litora torquent per conubia nostra, per inceptos himenaeos.Aenean sed ligula in sapien ullamcorper faucibus.Integer ac fermentum nisl, vel ullamcorper risus.Proin dapibus, turpis id lacinia finibus, tortor lectus facilisis tellus, eu lobortis neque enim sit amet purus.Donec malesuada tortor at augue pulvinar, ac ornare odio malesuada. In nulla dui, consectetur vel urna quis, sollicitudin egestas dui.Nulla suscipit purus ac augue ultricies posuere.Vivamus risus orci, faucibus et quam vitae, ullamcorper maximus quam.Maecenas lacus ipsum, auctor pulvinar viverra et, bibendum ut enim.Sed porttitor arcu eu auctor suscipit.
Integer nibh libero, semper eu vestibulum id, dignissim ac nibh.Maecenas consectetur faucibus dignissim. Proin vehicula placerat augue, scelerisque tristique purus faucibus ac.Sed luctus rutrum turpis, in rhoncus justo porttitor et. Aenean sem eros, tristique a justo vel, hendrerit laoreet enim.Vivamus eget nunc eget lacus suscipit placerat et et mauris. Aliquam vel massa suscipit, mattis sapien iaculis, mollis urna.
Nam pulvinar lobortis ipsum mollis commodo. Fusce et rutrum ex, suscipit tincidunt neque.Mauris interdum venenatis tortor at vehicula. Mauris dapibus vestibulum dapibus. Nullam lacinia felis in rhoncus gravida. Donec odio nisi, condimentum in pellentesque ac, volutpat nec felis.Donec maximus lorem vitae mi aliquet sodales.
Aliquam aliquet posuere nisl quis consequat. Cras lacinia in diam in scelerisque.Aliquam porttitor faucibus condimentum. Nullam ac lacus ipsum. Etiam vehicula efficitur mi iaculis imperdiet. Fusce vitae est a augue eleifend placerat ac ut lectus. Proin scelerisque massa in sagittis egestas. Fusce id metus pellentesque, pulvinar ante quis, viverra augue. Nam rhoncus turpis et leo consectetur condimentum.Duis elementum eleifend sem at efficitur. Fusce lacinia tempor volutpat. Praesent interdum, neque sit amet facilisis posuere, dui magna semper felis, sed iaculis justo enim et sapien. Etiam vel pulvinar nulla. Mauris vestibulum nunc in pharetra vehicula. Phasellus fringilla eros urna. Vestibulum malesuada massa et hendrerit tincidunt.
Duis eget justo quam. Duis quis dignissim dui, a lacinia magna.Pellentesque habitant morbi tristique senectus et netus et malesuada fames ac turpis egestas.Integer aliquet dignissim placerat. Etiam placerat purus sed quam volutpat placerat.Praesent convallis, quam id scelerisque commodo, libero magna gravida ante, sed convallis risus lorem ac magna. Lorem ipsum dolor sit amet, consectetur adipiscing elit.Praesent pulvinar laoreet tellus, eu cursus sem feugiat eget.Maecenas vel nisl quis felis tincidunt feugiat a in lectus.Duis vestibulum rhoncus lacus, quis dictum sem aliquet ac.In ultricies molestie nulla, quis maximus massa.Curabitur accumsan eget ex vitae scelerisque. Nam bibendum felis vel ipsum malesuada, a dapibus justo efficitur. Ut et volutpat odio, sit amet porta elit. Aliquam nulla urna, viverra at cursus ac, efficitur vel dui.Proin hendrerit euismod arcu, ac ultrices ligula porta vitae.
Phasellus at rhoncus odio, eget venenatis risus.Ut erat est, eleifend vel quam a, ornare ultricies libero.Aliquam risus augue, malesuada sed justo sit amet, commodo ornare ligula.Nunc quis vehicula felis. Phasellus ac diam a tortor rutrum luctus.Integer vulputate purus et viverra cursus. Sed tristique lacus et ullamcorper pharetra. Nunc maximus imperdiet dolor, non luctus nunc pretium quis.Phasellus non dui dolor. Duis dapibus, elit a luctus dapibus, dolor purus tristique leo, at ultrices dui lorem sit amet nibh.Ut pellentesque lacinia nisl. Sed et lorem neque. Vivamus rutrum, lorem nec ultricies scelerisque, turpis quam finibus sem, et laoreet sapien nisl eu diam. Maecenas sagittis egestas elit, vel ultricies eros iaculis id.Integer viverra metus vitae velit lobortis, pellentesque sodales turpis scelerisque. In finibus tincidunt ex quis interdum.
Phasellus ullamcorper tincidunt mi sit amet auctor.Vivamus sit amet sollicitudin mi, ac iaculis nunc.Sed porta euismod efficitur. Vivamus vitae scelerisque ipsum. Curabitur scelerisque blandit blandit. Aenean ut ligula tortor. Cras neque ligula, euismod ut ipsum ut, tempor rhoncus urna.Phasellus condimentum mi blandit sem ultrices placerat quis a dui. Cras euismod bibendum nibh, eget feugiat odio rhoncus in. Ut a facilisis tortor, gravida rhoncus leo.Nulla malesuada auctor commodo. Sed ac feugiat ante. Quisque eleifend purus augue, vitae eleifend lorem gravida eget.Maecenas laoreet odio vitae tempor consequat. Aenean hendrerit egestas mauris, eget facilisis magna posuere maximus.Curabitur ac dictum quam, fringilla ultricies nibh.
Morbi mi mi, elementum id arcu vel, tristique interdum eros.Nullam venenatis ante et nibh eleifend, ac sagittis metus egestas. Nunc sed blandit leo, in tincidunt purus. Proin ligula ex, tincidunt a finibus eget, semper in leo.Nullam at diam id mauris porta blandit.Morbi commodo massa ut metus posuere, nec vehicula nisl fermentum. Cras ut elit consectetur, sagittis diam et, molestie metus. Morbi vitae nulla venenatis, posuere elit vel, consectetur metus.
Aliquam convallis mollis enim et commodo. Vivamus rhoncus a enim nec lacinia. In eu tortor id metus porta varius.Pellentesque sollicitudin ipsum ut orci dapibus aliquam.Aenean a ante est. Ut vehicula sodales lorem eget lacinia. Proin tincidunt dui sit amet tempus porttitor.
Curabitur ut tortor purus. Quisque et mattis dolor, in gravida quam. Proin fringilla, sem non pellentesque molestie, leo augue pharetra urna, non ultrices augue urna at tortor. Aenean at lorem ullamcorper, faucibus velit sed, consequat mauris. Nam aliquam scelerisque erat, eu finibus metus commodo nec.Ut mattis ipsum nec sollicitudin tempor. Nunc eget elementum enim. Aenean eleifend sit amet augue vitae gravida.Mauris faucibus sodales velit at ultricies. Praesent cursus gravida nulla sit amet faucibus.Proin vel eros mi. Proin eu luctus erat.
Aenean lobortis urna mi, id fermentum turpis eleifend eget.Donec urna libero, feugiat sed mattis dapibus, eleifend sit amet metus. Nunc ullamcorper placerat vulputate. Maecenas interdum ligula quis sapien porttitor elementum.In ut quam id orci iaculis convallis.Donec nec egestas magna, eget dictum erat.Donec et orci fringilla, dapibus eros nec, tincidunt ante.
Quisque porttitor lacus sit amet fringilla tincidunt.Aenean suscipit ex venenatis ipsum bibendum interdum.Maecenas maximus vestibulum mauris, maximus ultricies leo dignissim et.Curabitur a risus eget lorem porta eleifend.Donec a mauris a nisl sagittis faucibus vitae ut velit. Curabitur eget venenatis nunc, vitae rutrum nulla.Integer vel urna quis metus lobortis iaculis ac at risus. Nam ac libero eget mi dignissim porttitor.Curabitur non consectetur neque, ac pretium quam.Donec condimentum urna vel velit tempor, quis venenatis eros porttitor.";


     [Fact]
        public void StandardCompression_AllCompressionLevels_CorrectCompression()
        {
            var data = Encoding.ASCII.GetBytes(TestMessage);

            for (int i = 1; i <= ZstandardStream.MaxCompressionLevel; i++)
            {
                var compressed = this.Compress(data, i);
                (compressed.Length < data.Length / 3).Should().BeTrue();
                var decompressed = this.Decompress(compressed);
                (decompressed.SequenceEqual(data)).Should().BeTrue();
            }
        }

        [Fact]
        public void StandardCompression_DifferentCompressionLevels_DifferentCompressionRatios()
        {
            var data = Encoding.ASCII.GetBytes(TestMessage);

            var compressedMin = this.Compress(data, 1);
            var compressedMax = this.Compress(data, ZstandardStream.MaxCompressionLevel);
            (compressedMin.Length > compressedMax.Length).Should().BeTrue();
        }

        [Fact]
        public void StandardCompression_IncompressibleData_NoCompression()
        {
            var data = this.GetRandomData(65536);
            var compressed = this.Compress(data, 11);
            (compressed.Length < data.Length + 32).Should().BeTrue();
        }

        // private methods
        private byte[] Compress(byte[] data, int compressionLevel)
        {
            using (var memoryStream = new MemoryStream())
            using (var compressionStream = new ZstandardStream(memoryStream, compressionLevel))
            {
                compressionStream.Write(data, 0, data.Length);
                compressionStream.Close();
                return memoryStream.ToArray();
            }
        }

        private byte[] Decompress(byte[] compressed)
        {
            using (var memoryStream = new MemoryStream(compressed))
            using (var compressionStream = new ZstandardStream(memoryStream, CompressionMode.Decompress))
            using (var temp = new MemoryStream())
            {
                compressionStream.CopyTo(temp);
                return temp.ToArray();
            }
        }

        private byte[] GetRandomData(int size)
        {
            var data = new byte[size];
            var random = new Random();
            random.NextBytes(data);
            return data;
        }
    }
}
